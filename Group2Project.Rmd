---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

Group Members:
Andrew Shooman
Xiangyu Zeng
Thao Nguyen
Yunzhou Liu
   
```{r, warning=FALSE, message=FALSE}
library(readr)
library(mosaic)
library(leaps)
source("./ShowSubsets.R")
houses = read_csv("AmesTrain2.csv")
```

Exclude all the categorical variables from this dataset.
```{r}
quantitative.house <- houses[c(2:4, 7:10, 17:19, 23:30, 32:33, 35:36, 39:42)]
head(quantitative.house)
```

## Part 1. Create an initial basic model

*build a model using Backward elimination, Forward selection, and Stepwise selection*

##### Build a model

This allows us to plot the variables to see the relationships between different variables.
```{r, echo=FALSE}
plot(quantitative.house$Price~., data=quantitative.house[c(2:26)])
```

Showing the RegSubsets tells us that the best model with 8 variables is:
`lm(Price ~ LotArea + Quality + YearBuilt + YearRemodel + BasementFinSF + BasementSF + GroundSF + GarageSF, data=quantitative.house)` with a Mallow's CP = 43.59
```{r}
all=regsubsets(quantitative.house$Price~., data=quantitative.house[2:26], nbest=2)
ShowSubsets(all)
```

We could also check by performing backward & forward & stepwise selection.

```{r}
Full = lm(quantitative.house$Price~., data=quantitative.house[c(2:26)])
MSE=(summary(Full)$sigma)^2
backward.elimination = step(Full,scale=MSE, trace=FALSE)
summary(backward.elimination)
```

```{r}
none = lm(quantitative.house$Price~1, data=quantitative.house[2:26])
forward.selection = step(none, scope=list(upper=Full), scale=MSE, direction="forward", trace=FALSE)
summary(forward.selection)
```

```{r}
stepwise.selection = step(none, scope=list(upper=Full), scale=MSE, trace=FALSE)
summary(stepwise.selection)
```


## Part 2. Residual Analysis for basic model

*Based off model from backward selection*

The residuals show a significant curved relationship in the fitted plot, indicicating that the prediction is different based off of the price of the house, violating one of the linear model conditions. Also, the normal Q-Q plot has some extreme values at the ends, further showing that the residuals are not constant throughout the model. However, all of the points fall within Cook's distance, indicating that none of the points have leverage significant enought to drastically change the model.

```{r}
basic.model <- houses[c(2:4, 7:10, 16:17, 23:24,30, 33, 36, 41:42)]

summary(basic.model)
plot(basic.model)
```

The maximum and minimum residual values of the model also have significantly large standardized and studentized values, which indicates both have the potential to have influence over the model, although both still are within Cooks Distance.

```{r}
range(basic.lm$residuals)
which.max(basic.lm$residuals)
which.min(basic.lm$residuals)
rstandard(basic.lm)[198]
rstudent(basic.lm)[198]
rstandard(basic.lm)[188]
rstudent(basic.lm)[188]
```


## Part 3. "Fancier model"

This model is built based on the result of RegSubsets. We have taken:
1. The log of the LotArea
2. The log of (2010 - YearBuilt)
3. The log of (2011 - YearRemodel)
4. Sum of log(Price) and sqrt(Price)

This transformation allows us to improve our Adjusted R-squared from 0.8516 to 0.8779.
```{r}
old.mod.two = lm(Price ~ LotArea + Quality + YearBuilt + YearRemodel 
                 + BasementFinSF + BasementSF + GroundSF + GarageSF, data=quantitative.house)
summary(old.mod.two)
mod.two = lm(I(log(Price) + sqrt(Price)) ~ log(sqrt(LotArea)) + Quality + log(2010 - YearBuilt) + log(2011 - YearRemodel) 
                 + BasementFinSF + BasementSF + GroundSF + GarageSF, data=quantitative.house)
summary(mod.two)
```

This model is built based on the result of Stepwise selection. We have taken: 
1. log of LotArea
2. log of (2010 - YearBuilt)
3. sum of log(Price) + sqrt(Price)

This transformation allows us to improve our Adjusted R-squared from 0.8611 to 0.8984
```{r}
old.mod = lm(formula = quantitative.house$Price ~ Quality + GroundSF + 
    BasementSF + YearBuilt + BasementFinSF + GarageSF + LotArea + 
    YearRemodel + Condition + ScreenPorchSF + LotFrontage + Fireplaces + 
    Bedroom + EnclosedPorchSF, data = quantitative.house[2:26])
summary(old.mod)
mod = lm(formula = I(log(quantitative.house$Price) + sqrt(quantitative.house$Price)) ~ Quality + GroundSF + 
    BasementSF + log(2010 - YearBuilt) + BasementFinSF + GarageSF + log(LotArea) + 
    YearRemodel + Condition + ScreenPorchSF + LotFrontage + Fireplaces + 
    Bedroom + EnclosedPorchSF, data = quantitative.house[2:26])
summary(mod)
```

## Part 4. Residual Analysis for fancier model
```{r}
plot(mod)
```

## Part 5. Final Model
